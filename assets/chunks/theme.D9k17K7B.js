function b(n,s){const o={lastUpdate:null,notionData:{},loading:!1};if(n.config.globalProperties.$notion={store:o,async getHomepageData(){var a;try{o.loading=!0,console.log("ğŸ” å¼€å§‹è·å–é¦–é¡µæ•°æ®...");const e=!1;let t;if(!e){const l=await fetch("/notion-data.json").catch(()=>null);l&&l.ok?t=await l.json():t={results:[]}}return console.log("ğŸ“‹ è·å–åˆ°çš„æ•°æ®æ•°é‡:",((a=t.results)==null?void 0:a.length)||0),o.notionData.home=t.results,o.lastUpdate=new Date,console.log("âœ… é¦–é¡µæ•°æ®æ›´æ–°æˆåŠŸ"),t.results}catch(e){return console.error("âŒ è·å–é¦–é¡µæ•°æ®å¤±è´¥:",e),[]}finally{o.loading=!1}},async getPageData(a){try{o.loading=!0;const e=!1;let t;if(!e){const l=await fetch("/notion-data.json").catch(()=>null);l&&l.ok?t={results:(await l.json()).results||[]}:t={results:[]}}return o.notionData[a]=t.results,o.lastUpdate=new Date,console.log(`âœ… é¡µé¢æ•°æ®æ›´æ–°æˆåŠŸ: ${a}`),t.results}catch(e){return console.error(`âŒ è·å–é¡µé¢æ•°æ®å¤±è´¥: ${a}`,e),[]}finally{o.loading=!1}},async getCategoryData(a){try{o.loading=!0;const e=!1;let t;if(!e){const l=await fetch("/notion-data.json").catch(()=>null);l&&l.ok?t={results:((await l.json()).results||[]).filter(i=>{var r,c,g,f,u,d,h,p,D,y;const $=((u=(f=(g=(c=(r=i.properties)==null?void 0:r.åç§°)==null?void 0:c.title)==null?void 0:g[0])==null?void 0:f.text)==null?void 0:u.content)||"",P=((y=(D=(p=(h=(d=i.properties)==null?void 0:d.æ–‡æœ¬)==null?void 0:h.rich_text)==null?void 0:p[0])==null?void 0:D.text)==null?void 0:y.content)||"";return $.includes(a)||P.includes(a)})}:t={results:[]}}return o.notionData["category_"+a]=t.results,o.lastUpdate=new Date,console.log(`âœ… åˆ†ç±»æ•°æ®æ›´æ–°æˆåŠŸ: ${a}`),t.results}catch(e){return console.error(`âŒ è·å–åˆ†ç±»æ•°æ®å¤±è´¥: ${a}`,e),[]}finally{o.loading=!1}}},typeof window<"u"){const a=s||window.__VP_ROUTER__;a&&(typeof a.on=="function"?(a.on("routeChangeStart",async e=>{console.log(`ğŸ”„ é¡µé¢åˆ‡æ¢: åˆ° ${e.path}`);try{if(o.loading=!0,e.path==="/")await n.config.globalProperties.$notion.getHomepageData();else if(["/ç½‘ç»œå®‰å…¨/","/æ¸—é€æµ‹è¯•/","/æ¼æ´åˆ†æ/","/åµŒå…¥å¼å®‰å…¨/","/CTFç«èµ›/"].includes(e.path)){const t=e.path.split("/")[1];await n.config.globalProperties.$notion.getCategoryData(t)}else e.path.includes("/")&&await n.config.globalProperties.$notion.getPageData(e.path)}catch(t){console.error("Failed to fetch Notion data:",t)}finally{o.loading=!1}}),a.on("routeChangeEnd",e=>{setTimeout(()=>{document.querySelector(".content")&&o.notionData[e.path]&&console.log(`ğŸ“„ é¡µé¢ ${e.path} åŠ è½½å®Œæˆï¼Œæ•°æ®å·²å°±ç»ª`)},500)})):typeof a.beforeEach=="function"&&(a.beforeEach(async(e,t)=>{console.log(`ğŸ”„ é¡µé¢åˆ‡æ¢: ä» ${(t==null?void 0:t.path)||"unknown"} åˆ° ${e.path}`);try{if(o.loading=!0,e.path==="/")await n.config.globalProperties.$notion.getHomepageData();else if(["/ç½‘ç»œå®‰å…¨/","/æ¸—é€æµ‹è¯•/","/æ¼æ´åˆ†æ/","/åµŒå…¥å¼å®‰å…¨/","/CTFç«èµ›/"].includes(e.path)){const l=e.path.split("/")[1];await n.config.globalProperties.$notion.getCategoryData(l)}else e.path.includes("/")&&await n.config.globalProperties.$notion.getPageData(e.path)}catch(l){console.error("Failed to fetch Notion data:",l)}finally{o.loading=!1}}),a.afterEach(async e=>{setTimeout(()=>{document.querySelector(".content")&&o.notionData[e.path]&&console.log(`ğŸ“„ é¡µé¢ ${e.path} åŠ è½½å®Œæˆï¼Œæ•°æ®å·²å°±ç»ª`)},500)}))),window.refreshNotionData=async e=>e==="/"?await n.config.globalProperties.$notion.getHomepageData():await n.config.globalProperties.$notion.getPageData(e)}}const m={install(n){const s={lastUpdate:null,notionData:{},loading:!1},o={getHomepageData:async()=>null,getPageData:async()=>null,getCategoryData:async()=>null};n.config.globalProperties.$notion={store:s,...o,...n.config.globalProperties.$notion||{}},n.provide("notion",n.config.globalProperties.$notion)}},E={enhanceApp({app:n,router:s}){n.use(m),b(n,s)}};export{E as R};
